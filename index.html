<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run & Write Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Poppins', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        html, body {
            scroll-behavior: smooth;
        }
        .prompt-display {
            min-height: 120px;
            transition: all 0.3s ease;
            white-space: pre-wrap;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #f97316; /* orange-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-4 sm:p-6 lg:p-8 font-sans flex items-center justify-center">

    <!-- Main container -->
    <div class="w-full max-w-2xl mx-auto p-6 sm:p-8 md:p-12 relative">
        
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold tracking-tight text-slate-900">Run & Write</h1>
            <p class="mt-4 text-lg md:text-xl text-slate-600">Your Daily Dose of Creative Inspiration</p>
        </header>

        <!-- Daily Prompt Section -->
        <main class="text-center bg-white rounded-xl shadow-lg p-8 border border-slate-200">
            <h2 class="text-3xl font-bold text-orange-500 tracking-wide">Today's Writing Prompt</h2>
            <p class="mt-3 max-w-2xl mx-auto text-slate-500">A new challenge, a blank page. What story will you tell today?</p>
            <div id="dailyPromptDisplay" class="prompt-display bg-slate-100/70 p-6 rounded-lg text-2xl text-slate-700 italic mt-6 flex items-center justify-center text-center border border-slate-200">
                <div class="spinner"></div>
            </div>
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dailyPromptDisplay = document.getElementById('dailyPromptDisplay');
            
            async function getDailyPrompt() {
                dailyPromptDisplay.innerHTML = '<div class="spinner mx-auto"></div>';
                
                const todayDateString = new Date().toISOString().split('T')[0];
                const storedPromptData = localStorage.getItem('dailyPromptData');

                if (storedPromptData) {
                    try {
                        const { prompt, date } = JSON.parse(storedPromptData);
                        if (date === todayDateString && prompt) {
                            dailyPromptDisplay.innerText = prompt;
                            return; 
                        }
                    } catch (e) {
                        console.error("Could not parse stored prompt data.", e);
                        localStorage.removeItem('dailyPromptData');
                    }
                }

                const userPrompt = `Based on the date ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}, generate a single, evocative, genre-neutral writing prompt for a daily writing challenge called 'Run & Write'. The prompt should be one compelling sentence.`;

                try {
                    const response = await fetch('/api/get-prompt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: userPrompt })
                    });

                    // --- A WISER GATEKEEPER ---
                    // Now we properly interrogate the response before assuming it's okay.
                    if (!response.ok) {
                        // The server responded with an error status. Let's find out why.
                        const errorData = await response.json(); // Attempt to parse the error message from the server.
                        // Construct a detailed error message for display.
                        const errorMessage = `Error: ${errorData.message || 'Unknown server error.'}` + (errorData.detail ? ` (Details: ${errorData.detail})` : '');
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();
                    const newPromptText = result.text;

                    if (newPromptText) {
                        dailyPromptDisplay.innerText = newPromptText;
                        const dataToStore = {
                            prompt: newPromptText,
                            date: todayDateString
                        };
                        localStorage.setItem('dailyPromptData', JSON.stringify(dataToStore));
                    } else {
                         dailyPromptDisplay.innerText = 'The response was empty. Please try again.';
                    }

                } catch (error) {
                    // This will now display our more detailed, server-provided error.
                    dailyPromptDisplay.innerText = `A network error occurred: ${error.message}`;
                }
            }

            getDailyPrompt();
        });
    </script>

</body>
</html>

